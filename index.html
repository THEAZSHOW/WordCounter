<!DOCTYPE html>
<html lang="en">
<head>

<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Counter & Text Analyzer</title>
    <link rel="stylesheet" href="style.css">
    <!-- The <style> tag from the previous answer can be removed or kept -->
    <script src="script.js"></script>

    
</head>

<body>

    <header class="main-header">
        <h1>
            <span id="word-count">0</span> words <span id="char-count">0</span> characters
        </h1>
        <p>Your text might contain writing issues - Check now</p>
    </header>

    <main class="container">
        <div class="editor-panel">
            <div class="textarea-container">
                <div id="highlighter" class="highlighter-backdrop" aria-hidden="true"></div>
                <textarea id="text-input" spellcheck="false" placeholder="Start writing or paste your text here..."></textarea>
            </div>
        </div>

        <aside class="sidebar">
            <details class="sidebar-section" open>
                <summary>Details</summary>
                <div class="section-content">
                    <div class="details-grid">
                        <span>Words</span><span id="details-words">0</span>
                        <span>Characters</span><span id="details-chars">0</span>
                        <span>Sentences</span><span id="details-sentences">0</span>
                        <span>Paragraphs</span><span id="details-paragraphs">0</span>
                        <span>Reading Time</span><span id="details-reading-time">0 sec</span>
                        <span>Speaking Time</span><span id="details-speaking-time">0 sec</span>
                    </div>
                </div>
            </details>

            <details class="sidebar-section" open>
                <summary>Keyword Density</summary>
                <div class="density-tabs">
                    <button class="tab-btn" data-ngram="1">x1</button>
                    <button class="tab-btn active" data-ngram="2">x2</button>
                    <button class="tab-btn" data-ngram="3">x3</button>
                </div>
                <div class="section-content">
                    <div id="density-list" class="density-list">
                        <!-- Density results will be injected here -->
                    </div>
                </div>
            </details>
        </aside>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const textInput = document.getElementById('text-input');

             // Load saved text on page load
textInput.value = localStorage.getItem('savedText') || '';

// Save text on input
textInput.addEventListener('input', () => {
    localStorage.setItem('savedText', textInput.value);
});

            
            const highlighter = document.getElementById('highlighter');

            // Header counters
            const wordCountEl = document.getElementById('word-count');
            const charCountEl = document.getElementById('char-count');

            // Details panel
            const detailsWordsEl = document.getElementById('details-words');
            const detailsCharsEl = document.getElementById('details-chars');
            const detailsSentencesEl = document.getElementById('details-sentences');
            const detailsParagraphsEl = document.getElementById('details-paragraphs');
            const detailsReadingTimeEl = document.getElementById('details-reading-time');
            const detailsSpeakingTimeEl = document.getElementById('details-speaking-time');

            // Density panel
            const densityListEl = document.getElementById('density-list');
            const densityTabsContainer = document.querySelector('.density-tabs');

            let currentNgramSize = 2; // Default to bigrams (x2)
            let currentHighlightedPhrase = null;

            // --- UTILITY FUNCTIONS ---
            const formatTime = (seconds) => {
                if (isNaN(seconds) || seconds < 1) return '0 sec';
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = Math.round(seconds % 60);
                let result = '';
                if (minutes > 0) result += `${minutes} min `;
                if (remainingSeconds > 0 || minutes === 0) result += `${remainingSeconds} sec`;
                return result.trim();
            };

            const escapeRegExp = (string) => {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            };

            const escapeHTML = (str) => {
                return str.replace(/&/g, "&").replace(/</g, "<").replace(/>/g, ">");
            };

            // --- CORE LOGIC ---
            const analyzeText = () => {
                const text = textInput.value;
                
                // 1. Update Details Panel
                const words = text.trim().split(/\s+/).filter(Boolean);
                const wordCount = text.trim() === '' ? 0 : words.length;
                const charCount = text.length;
                // Treat each line as a "paragraph" like in the original image's context
                const paragraphCount = text.split('\n').filter(line => line.trim() !== '').length;
                const sentenceCount = (text.match(/[.!?]+|\n/g) || []).filter(s => s.trim().length > 0).length || (text.trim() ? 1 : 0);
                
                wordCountEl.textContent = wordCount;
                charCountEl.textContent = charCount;
                detailsWordsEl.textContent = wordCount;
                detailsCharsEl.textContent = charCount;
                detailsSentencesEl.textContent = sentenceCount;
                detailsParagraphsEl.textContent = paragraphCount;
                
                // Reading time (avg. 270 WPM) & Speaking time (avg. 180 WPM)
                detailsReadingTimeEl.textContent = formatTime((wordCount / 270) * 60);
                detailsSpeakingTimeEl.textContent = formatTime((wordCount / 180) * 60);

                // 2. Update Keyword Density
                updateDensity(words);

                // 3. Update Highlighter
                updateHighlighter();
            };

            const updateDensity = (words) => {
                densityListEl.innerHTML = '';
                if (words.length < currentNgramSize) return;

                const ngrams = new Map();
                const cleanWords = words.map(w => w.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,""));
                
                for (let i = 0; i <= cleanWords.length - currentNgramSize; i++) {
                    const ngram = cleanWords.slice(i, i + currentNgramSize).join(' ');
                    if (ngram.trim().length > 0) {
                       ngrams.set(ngram, (ngrams.get(ngram) || 0) + 1);
                    }
                }

                const sortedNgrams = [...ngrams.entries()]
                    .filter(([phrase, count]) => count > 1)
                    .sort((a, b) => b[1] - a[1]);

                sortedNgrams.forEach(([phrase, count]) => {
                    const item = document.createElement('div');
                    item.className = 'density-item';
                    item.innerHTML = `<span class="phrase">${escapeHTML(phrase)}</span><span class="count">${count}</span>`;
                    item.addEventListener('click', () => {
                        currentHighlightedPhrase = phrase;
                        updateHighlighter();
                    });
                    densityListEl.appendChild(item);
                });
            };

            const updateHighlighter = () => {
                const text = textInput.value;
                let highlightedText = escapeHTML(text);

                if (currentHighlightedPhrase) {
                    const regex = new RegExp(escapeRegExp(currentHighlightedPhrase), 'gi');
                    highlightedText = highlightedText.replace(regex, (match) => `<span class="highlight">${match}</span>`);
                }
                
                highlighter.innerHTML = highlightedText + '\n'; // Add trailing newline for scroll sync
            };

            // --- EVENT LISTENERS ---
            textInput.addEventListener('input', analyzeText);
            
            // Sync scrolling
            textInput.addEventListener('scroll', () => {
                highlighter.scrollTop = textInput.scrollTop;
                highlighter.scrollLeft = textInput.scrollLeft;
            });

            // Tab switching for keyword density
            densityTabsContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    densityTabsContainer.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    currentNgramSize = parseInt(e.target.dataset.ngram, 10);
                    currentHighlightedPhrase = null; // Clear highlight on tab switch
                    analyzeText(); // Re-analyze with new N-gram size
                }
            });

            // Initial analysis on load (if there's any pre-filled text)
            analyzeText();
        });
    </script>
</body>
</html>
